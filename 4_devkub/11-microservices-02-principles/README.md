## Домашнее задание к занятию "11.02 Микросервисы: принципы"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

### Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- Маршрутизация запросов к нужному сервису на основе конфигурации
- Возможность проверки аутентификационной информации в запросах
- Обеспечение терминации HTTPS

Ранее ни с API Gateway, ни с брокерами сообщений дел не имел, так что попытался слегка углубится в тему, возможны неточности и неправильные утверждения.  

| Наименование.Примечание | Маршрутизация запросов к нужному сервису на основе конфигурации | Возможность проверки аутентификационной информации в запросах | Обеспечение терминации HTTPS |
|:-------|:-------|:-------|:-------|
| Kong Gateway<br> (https://konghq.com/gateway/, https://github.com/Kong/kong),<br> Приложение Lua, работающее на Nginx. | Есть. <br>Все маршруты в бд или yaml файле, где именно указывается в kong.conf.default | Есть. <br> токен передается в заголовке | Есть |
| Gravitee.<br> (https://www.gravitee.io/) | Есть. <br>все маршруты по умолчанию в МонгоБД. | Есть. <br> токен передается в заголовке | Есть. <br> может терминировать, а может и далльше пропускать |
| Tyk. <br> (https://tyk.io/features/api-gateway/) | Есть. <br> json файл для каждого сервиса. | Есть. <br>в запросе указывается user: pass, или через токен доступа.<br> https://tyk.io/docs/getting-started/create-api-key/ | Есть. |
| HAProxy. <br> (https://www.haproxy.com/) | Есть. <br> Через map file | Есть. <br> токен авторизации присоединяется к запросу в HTTP заголовке.<br> https://www.haproxy.com/blog/using-haproxy-as-an-api-gateway-part-2-authentication/ | Есть. <br> https://www.haproxy.com/blog/haproxy-ssl-termination/ |
| Nginx. <br> https://www.nginx.com/ | Есть. | Есть. | Есть. |

Обоснуйте свой выбор.  
Выбрал бы Kong или HAProxy, но т.к. Kong-у вроде нужна БД(Postgresql), то сейчас выбрал бы HAProxy(проще в настройке).  

### Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- Поддержка кластеризации для обеспечения надежности
- Хранение сообщений на диске в процессе доставки
- Высокая скорость работы
- Поддержка различных форматов сообщений
- Разделение прав доступа к различным потокам сообщений
- Протота эксплуатации

| Наименование. <br> Примечание | Поддержка кластеризации для обеспечения надежности | Хранение сообщений на диске в процессе доставки | Высокая скорость работы | Поддержка различных форматов сообщений | Разделение прав доступа к различным потокам сообщений | Протота эксплуатации |
|:-------|:-------|:-------|:-------|:--------|:-------|:-------|
| Apache Kafka.<br> (https://kafka.apache.org/) | Есть. | хранит и не удаляет до очистки журнала | Есть. <br>за счет горизонтальной масштабируемости и последовательной записи сообщений в бд, + множество оптимизаций) | Насколько понял Kafka использует свой формат сообщений ключ:значение. https://kafka.apache.org/documentation/#messages | Есть. <br> https://kafka.apache.org/documentation/#security_authz | Не могу сказать, т.к. не использовал |
| RabbitMQ.<br> (https://www.rabbitmq.com/) | Есть. | Есть.<br> Хранит и удаляет сообщение после доставки его получателю | Есть. | Есть. <br> через плагины | Есть. <br> https://www.rabbitmq.com/access-control.html | Не могу сказать. |
| ActiveMQ.<br> (https://activemq.apache.org/) | Нет. <br>но можно сделать мастер-слейв. | Есть. <br> Есть вариант настройки без хранения сообщений. | Нет. <br> Отслеживает состояние доставки каждого сообщения, приводит к снижению пропускной способности. | Нет. <br>сообщение состоит из метаданных (заголовки и свойства) и тела (которое является полезной нагрузкой). | Есть.<br> https://activemq.apache.org/security | Пишут что проще чем Kafka |

Обоснуйте свой выбор.  
Зависит от задачи. Если нагрузка не большая то ActiveMQ. Если посерьезнее - Apache Kafka.
